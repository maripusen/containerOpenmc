BootStrap: docker

From: fedora:39

%files 
    /Users/mtorsvoll/documents/utvikling4580/endfb-vii.1-hdf5 /openmc_install

%post 

    mkdir openmc_install && cd openmc_install
    ls 
    pwd 

    ##obtaining cross sections and depletion chains
    
    pwd 
    
    dnf install -y wget

    dnf install -y xz 



    ##
    ## dependencies for openmc 
    ##

    dnf install -y build-essential 

    dnf install -y hdf5-devel

    #dnf install -y hdf5

    dnf install -y libpng-devel 

    #dnf install -y libpng

    dnf install -y gcc

    dnf install -y git 

    dnf install -y xtensor 

    dnf install -y python-devel 

    dnf install -y python3-pip 
    
    dnf install -y python3-h5py
    
    dnf install -y numpy 

    dnf install -y cmake 

    #dnf install -y pandas

    #dnf install -y matplotlib

    dnf 
    ##
    ##python packages
    ##

    pip install --upgrade pip setuptools wheel

    #pip3 install h5py
    
    #pip3 install numpy 

    #pip3 install pandas

    #pip3 install matplotlib


    ##
    ##installing openmc
    ##
    
    

    ##
    ## Getting openMC v0.13.3 for now. 
    ##


    git clone --recurse-submodules https://github.com/openmc-dev/openmc.git
    
    
    cd openmc
    mkdir build && cd build
    cmake ..
    make 
    make install 
    cd ..
    
    
    python3 -m pip install .

    ##
    ## testing openmc cross section installation 
    ##
    
    
    #cd ..
    #ls 
    #cd /endfb-vii.1-hdf5
    #ls 
    #pwd 



%environment 
    export OPENMC_CROSS_SECTIONS=/openmc_install/endfb-vii.1-hdf5/cross_sections.xml 


%runscript
    #!/usr/bin/env bash

    echo "This is an apptainer container for the neutron transport code"
    echo "Based on Linux distro Fedora39 for now." 
    echo "Container assembled by Marius Torsvoll, 2024"
    echo ""
    echo "Current directory:" $(pwd)
    echo "Content:"
    ls -lah
    echo "Running OpenMC with arguments:"
    echo $@
    echo
    
    python3 $@

%labels
    Author: Marius Torsvoll

%help 
    This container runs the neutron transport code openMC 

    To just run openMC with a given input file, run the container as
    `apptainer run prototype.sif INPUTFILE`

    or 

    `./prototype.sif INPUTFILE`

    To open a new shell inside the container, simply do:
    `apptainer shell prototype.sif`
    This will give you a new terminal with openMC and related tools installed,
    and e.g. your home directory mounted.

    To see this help text, run
    `apptainer run-help prototype.sif`